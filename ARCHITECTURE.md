# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ StreamYard Clone

–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞.

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

StreamYard Clone ‚Äî —ç—Ç–æ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä—è–º—ã—Ö —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–π, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        CLIENT TIER                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  React Frontend (WebRTC + Canvas + Socket.io)       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      REVERSE PROXY                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              Nginx Load Balancer                     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    APPLICATION TIER                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Backend  ‚îÇ  ‚îÇSignaling ‚îÇ  ‚îÇ   Media   ‚îÇ  ‚îÇ   RTMP   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   API    ‚îÇ  ‚îÇ  Server  ‚îÇ  ‚îÇ  Server   ‚îÇ  ‚îÇ  Relay   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ(Express) ‚îÇ  ‚îÇ(Socket.io‚îÇ  ‚îÇ(Mediasoup)‚îÇ  ‚îÇ  (NMS)   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       DATA TIER                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ  PostgreSQL  ‚îÇ           ‚îÇ    Redis     ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ   Database   ‚îÇ           ‚îÇ    Cache     ‚îÇ              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. Frontend (React + TypeScript)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- React 18
- TypeScript
- WebRTC API
- Canvas API
- Socket.io Client
- Zustand (State Management)
- Tailwind CSS

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:**

#### VideoGrid
–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö layout'–æ–≤:
- Grid (—Å–µ—Ç–∫–∞)
- Spotlight (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏–∫–µ—Ä + –º–∞–ª—ã–µ –æ–∫–Ω–∞)
- Sidebar (–±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å)

#### ControlPanel
–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–µ–π:
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –∫–∞–º–µ—Ä—ã
- Screen sharing
- –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
- –ù–∞—á–∞–ª–æ/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏

#### WebRTC Service
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏:
- getUserMedia –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º–µ–¥–∏–∞
- RTCPeerConnection –¥–ª—è P2P —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Mediasoup Client –¥–ª—è SFU

#### Socket Service
WebSocket –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ signaling —Å–µ—Ä–≤–µ—Ä—É
- –û–±–º–µ–Ω SDP/ICE candidates
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

### 2. Backend API (Node.js + Express)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Express.js
- TypeScript
- Prisma ORM
- PostgreSQL
- Redis
- JWT Authentication

**API Endpoints:**

```
/api/auth
  POST   /register      - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  POST   /login         - –í—Ö–æ–¥
  GET    /me            - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  POST   /logout        - –í—ã—Ö–æ–¥

/api/broadcasts
  GET    /              - –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–π
  POST   /              - –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é
  GET    /:id           - –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é
  PATCH  /:id           - –û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é
  DELETE /:id           - –£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é
  POST   /:id/start     - –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é
  POST   /:id/end       - –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é

/api/broadcasts/:id/destinations
  POST   /              - –î–æ–±–∞–≤–∏—Ç—å destination
  DELETE /:destId       - –£–¥–∞–ª–∏—Ç—å destination
  POST   /:destId/test  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

/api/recordings
  GET    /              - –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
  GET    /:id           - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å—å
  DELETE /:id           - –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å

/api/upload
  POST   /              - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
```

**Database Schema:**

```sql
Users
‚îú‚îÄ id (uuid)
‚îú‚îÄ email (unique)
‚îú‚îÄ password (hashed)
‚îú‚îÄ name
‚îú‚îÄ avatar
‚îú‚îÄ subscriptionTier
‚îî‚îÄ timestamps

Broadcasts
‚îú‚îÄ id (uuid)
‚îú‚îÄ userId (foreign key)
‚îú‚îÄ title
‚îú‚îÄ description
‚îú‚îÄ status (scheduled|live|ended)
‚îú‚îÄ settings (json)
‚îú‚îÄ startTime
‚îú‚îÄ endTime
‚îî‚îÄ timestamps

Destinations
‚îú‚îÄ id (uuid)
‚îú‚îÄ broadcastId (foreign key)
‚îú‚îÄ platform (youtube|facebook|twitch)
‚îú‚îÄ streamKey (encrypted)
‚îú‚îÄ rtmpUrl
‚îî‚îÄ status

Participants
‚îú‚îÄ id (uuid)
‚îú‚îÄ broadcastId (foreign key)
‚îú‚îÄ userId (foreign key, nullable)
‚îú‚îÄ name
‚îú‚îÄ role (host|guest|viewer)
‚îú‚îÄ audioEnabled
‚îú‚îÄ videoEnabled
‚îî‚îÄ timestamps

Recordings
‚îú‚îÄ id (uuid)
‚îú‚îÄ broadcastId
‚îú‚îÄ userId (foreign key)
‚îú‚îÄ title
‚îú‚îÄ duration
‚îú‚îÄ fileSize
‚îú‚îÄ url
‚îî‚îÄ timestamps
```

### 3. Signaling Server (Socket.io)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏

**Events:**

```typescript
// Client -> Server
join-broadcast          // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
leave-broadcast         // –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
webrtc-offer            // –û—Ç–ø—Ä–∞–≤–∫–∞ SDP offer
webrtc-answer           // –û—Ç–ø—Ä–∞–≤–∫–∞ SDP answer
ice-candidate           // –û—Ç–ø—Ä–∞–≤–∫–∞ ICE candidate
participant-status      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
chat-message            // –°–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç

// Server -> Client
participant-joined      // –ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫
participant-left        // –£—á–∞—Å—Ç–Ω–∏–∫ –≤—ã—à–µ–ª
participant-status-updated
webrtc-offer            // –ü–æ–ª—É—á–µ–Ω offer
webrtc-answer           // –ü–æ–ª—É—á–µ–Ω answer
ice-candidate           // –ü–æ–ª—É—á–µ–Ω ICE candidate
broadcast-started       // –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è –Ω–∞—á–∞–ª–∞—Å—å
broadcast-ended         // –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
chat-message            // –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```

**Room Management:**
```typescript
class RoomManager {
  private rooms: Map<broadcastId, Map<socketId, Participant>>
  
  addParticipant()
  removeParticipant()
  updateParticipant()
  getParticipants()
}
```

### 4. Media Server (Mediasoup)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
SFU (Selective Forwarding Unit) –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –º–µ–¥–∏–∞ –ø–æ—Ç–æ–∫–æ–≤

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Worker    ‚îÇ
‚îÇ  (Process)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
      ‚îú‚îÄ Router
      ‚îÇ   ‚îú‚îÄ Transport (WebRTC)
      ‚îÇ   ‚îÇ   ‚îú‚îÄ Producer (audio/video)
      ‚îÇ   ‚îÇ   ‚îî‚îÄ Consumer (audio/video)
      ‚îÇ   ‚îÇ
      ‚îÇ   ‚îî‚îÄ Transport (WebRTC)
      ‚îÇ       ‚îú‚îÄ Producer
      ‚îÇ       ‚îî‚îÄ Consumer
```

**Codecs:**
- Audio: Opus (48kHz, stereo)
- Video: VP8, VP9, H.264

**API Endpoints:**
```
GET  /router/capabilities   - RTP capabilities
POST /transport/create      - –°–æ–∑–¥–∞—Ç—å transport
POST /transport/connect     - –ü–æ–¥–∫–ª—é—á–∏—Ç—å transport
POST /transport/produce     - –ù–∞—á–∞—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –º–µ–¥–∏–∞
POST /transport/consume     - –ù–∞—á–∞—Ç—å –ø—Ä–∏–µ–º –º–µ–¥–∏–∞
```

### 5. RTMP Relay (Node-Media-Server)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü—Ä–∏–µ–º RTMP –ø–æ—Ç–æ–∫–∞ –∏ —Ä–µ—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º (multistreaming)

**Flow:**
```
Compositor ‚Üí RTMP Relay ‚Üí YouTube
                        ‚Üí Facebook
                        ‚Üí Twitch
                        ‚Üí Custom RTMP
```

**Features:**
- RTMP Ingest (–ø–æ—Ä—Ç 1935)
- HLS/DASH —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥
- HTTP-FLV streaming
- Multi-destination relay

**Configuration:**
```javascript
{
  rtmp: {
    port: 1935,
    chunk_size: 60000,
    gop_cache: true,
  },
  http: {
    port: 8888,
    allow_origin: '*',
  },
  trans: {
    ffmpeg: '/usr/bin/ffmpeg',
    tasks: [...]
  }
}
```

### 6. Compositor (FFmpeg)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ö–æ–º–ø–æ–∑–∏—Ç–∏–Ω–≥ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫–æ–≤ –≤ –æ–¥–∏–Ω –≤—ã—Ö–æ–¥–Ω–æ–π

**Layouts:**

**Grid (2x2):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User1 ‚îÇ  User2 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  User3 ‚îÇ  User4 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Spotlight:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  ‚îÇ
‚îÇ   Main Speaker   ‚îÇ
‚îÇ                  ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ         ‚îÇ Guest  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**FFmpeg Filter Complex:**
```bash
ffmpeg -i input1 -i input2 -i input3 -i input4 \
  -filter_complex "
    [0:v]scale=640:360[v0];
    [1:v]scale=640:360[v1];
    [2:v]scale=640:360[v2];
    [3:v]scale=640:360[v3];
    [v0][v1]hstack[top];
    [v2][v3]hstack[bottom];
    [top][bottom]vstack[out]
  " \
  -map "[out]" -c:v libx264 -preset veryfast \
  -f flv rtmp://localhost/live/stream
```

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### WebRTC Connection Flow

```
1. User joins broadcast
   ‚Üì
2. Frontend requests RTP capabilities from Media Server
   ‚Üì
3. Frontend creates Mediasoup Device with capabilities
   ‚Üì
4. Frontend creates Send Transport
   ‚Üì
5. Frontend produces audio/video tracks
   ‚Üì
6. Other participants create Recv Transport
   ‚Üì
7. Other participants consume the tracks
   ‚Üì
8. Media flows through SFU to all participants
```

### Broadcast Start Flow

```
1. User clicks "Go Live"
   ‚Üì
2. Frontend sends start-broadcast event to Signaling Server
   ‚Üì
3. Signaling Server notifies all participants
   ‚Üì
4. Compositor starts combining streams
   ‚Üì
5. Compositor sends composite stream to RTMP Relay
   ‚Üì
6. RTMP Relay distributes to all destinations
   ‚Üì
7. Stream goes live on YouTube/Facebook/Twitch
```

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**Media Servers:**
- –ù–µ—Å–∫–æ–ª—å–∫–æ Media Server –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
- Load balancing —á–µ—Ä–µ–∑ Nginx
- Redis –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**Backend API:**
- Stateless design
- –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
- Session storage –≤ Redis

**Database:**
- PostgreSQL read replicas
- Connection pooling (PgBouncer)
- Sharding –ø–æ userId

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**Media Server:**
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ CPU cores –¥–ª—è encoding
- –ë–æ–ª—å—à–µ RAM –¥–ª—è buffering
- SSD –¥–ª—è HLS segments

**RTMP Relay:**
- –ë–æ–ª–µ–µ –º–æ—â–Ω—ã–π CPU –¥–ª—è FFmpeg
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ç–∏

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- JWT tokens
- Refresh tokens –≤ Redis
- HttpOnly cookies

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- Role-based access control (RBAC)
- –í–ª–∞–¥–µ–ª–µ—Ü broadcast –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å
- –ì–æ—Å—Ç–∏ –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞

### WebRTC Security
- DTLS-SRTP encryption
- ICE candidate filtering
- TURN server —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

### Data Protection
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ stream keys –≤ –ë–î
- HTTPS/WSS –≤ production
- Rate limiting –Ω–∞ API endpoints

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Metrics
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö broadcasts
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- CPU/Memory usage
- Network bandwidth
- WebRTC connection quality

### Logging
- Morgan –¥–ª—è HTTP –ª–æ–≥–æ–≤
- Winston –¥–ª—è application –ª–æ–≥–æ–≤
- Mediasoup debug logs
- FFmpeg encoding logs

### Alerting
- CPU > 80%
- Memory > 90%
- Disk space < 10%
- Connection failures

## Performance Optimization

### Frontend
- Code splitting
- Lazy loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- Canvas rendering optimization
- WebRTC simulcast

### Backend
- Database query optimization
- Redis caching
- Connection pooling
- Gzip compression

### Media
- Adaptive bitrate
- Simulcast (multiple qualities)
- Jitter buffers
- Packet loss recovery

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **AI Features:**
   - –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ–æ–Ω—ã (BodyPix/MediaPipe)
   - Auto-framing
   - Noise cancellation

2. **Advanced Features:**
   - Picture-in-picture
   - Lower thirds (–±–∞–Ω–Ω–µ—Ä—ã)
   - Transition effects
   - Green screen

3. **Analytics:**
   - Real-time viewer analytics
   - Engagement metrics
   - Heatmaps

4. **Cloud Recording:**
   - AWS S3 integration
   - Auto-transcoding
   - Thumbnail generation

5. **CDN Integration:**
   - CloudFlare Stream
   - AWS CloudFront
   - Edge caching

---

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –∏ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É–µ—Ç—Å—è! üöÄ**



